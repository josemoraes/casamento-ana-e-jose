<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Casamento de Ana e José</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Tangerine:wght@700&display=swap"
      rel="stylesheet"
    />
    <style>
      .tangerine-bold {
        font-family: "Tangerine", cursive;
        font-weight: 700;
        font-style: normal;
      }
    </style>
  </head>
  <body class="bg-slate-100 relative">
    <header class="w-full bg-slate-100 p-3 text-center py-5">
      <h2 class="tangerine-bold text-5xl">Filtros</h2>
      <div class="flex flex-row items-center justify-center" id="filters"></div>
    </header>
    <main class="flex flex-col"></main>
    <section
      id="presentation-box"
      class="hidden top-0 w-full h-full z-10 flex flex-row items-center justify-center"
    >
      <img
        loading="lazy"
        class="max-w-full rounded-lg h-auto md:h-5/6 fixed md:top-12 z-30"
        src="./assets/imgs/A+J1.jpg"
      />
      <div class="w-full h-full fixed z-20 backdrop-blur-lg bg-white/40"></div>
    </section>
    <footer
      class="fixed bottom-0 left-0 right-0 w-full bg-white shadow-md text-center tangerine-bold z-30"
    >
      <h1 class="text-5xl pb-5 pt-3">Ana & José</h1>
    </footer>
  </body>
  <script>
    (function () {
      const pipeFunctions = (...fns) =>
        fns.reduce((inner, outer) => (arg) => outer(inner(arg)));
      const _AMOUNT_OF_IMGS = 947;
      const _AMOUNT_OF_VIDS = 2;
      const _TAGS = ["cerimônia", "festa", "vídeo"];

      const buildGalleryContent = ({ amountOfImgs, amountOfVids }) => {
        let imgsGallery = [];
        let vidsGallery = [];
        for (const imgId of Array.from({ length: amountOfImgs }, (_, value)=> value).values()) {
          imgsGallery.push({
            filename: `A+J${imgId + 1}`,
            ext: "jpg",
            tags: [imgId < 667 ? "cerimônia" : "festa"],
          });
        }

        for (const vidId of Array.from({ length: amountOfVids }, (_, value)=> value).values()) {
          vidsGallery.push({
            filename: `A+J${vidId + 1}`,
            ext: "mp4",
            tags: [vidId < 2 ? "cerimônia" : "festa", "vídeo"],
          });
        }
        
        const sortedContents = [...imgsGallery, ...vidsGallery].sort((left, right) => {
            const nameLeft = `${left.filename}${left.tags.join('')}`;
            const nameRight = `${right.filename}${right.tags.join('')}`;
            if (nameLeft < nameRight) {
              return -1;
            }
            if (nameLeft > nameRight) {
              return 1;
            }
            return 0;
          });

        return {
          contents: sortedContents,
        };
      };

      const buildGrid = ({contents}) => {
        let grid = "";
        let pointerPos = 1;
        for(const content of contents){
          if (pointerPos === 1) {
            grid += `<div class="flex flex-row items-center justify-center ">`;
          }

          if(content.ext === 'jpg'){
            grid += `<div class="tagged-to-filter" data-tags="${content.tags.join(',')}"><img loading="lazy" class="h-auto max-w-full rounded-xl p-2" src="./assets/imgs/${content.filename}.${content.ext}""></div>`;
          }

          if(content.ext === 'mp4'){
            grid += `<div class="tagged-to-filter" data-tags="${content.tags.join(',')}">
              <video class="h-auto max-w-full rounded-lg" controls>
                <source src="./assets/videos/${content.filename}.${content.ext}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
              </div>`;
          }

          if (pointerPos === 2) {
            grid += "</div>";
            pointerPos = 0;
          }
          pointerPos++;
        }
        return grid;
      };

      const appendGridToPage = (grid) => {
        document.querySelector("main").innerHTML = grid;
      };

      const addClickEventToPresentationBox = () => {
        const presentationBox = document.getElementById("presentation-box");
        presentationBox.addEventListener("click", () => {
          presentationBox.classList.replace("fixed", "hidden");
        });
      };

      const addClickEventsToImgs = () => {
        const presentationBox = document.getElementById("presentation-box");
        const presentationImg = document.querySelector("#presentation-box img");
        document
          .querySelectorAll("img")
          .values()
          .forEach((img) => {
            img.addEventListener("click", () => {
              presentationImg.setAttribute("src", img.getAttribute("src"));
              presentationBox.classList.replace("hidden", "fixed");
            });
          });
      };

      const buildFilter = ({ tags }) => {
        let options = "";
        for (tag of tags) {
          options += `<label for="filter-by-${tag}"
                      class="bg-gray-100 text-gray-800 text-md font-medium me-2 px-2.5 py-0.5 rounded dark:bg-gray-700 dark:text-gray-400 border border-gray-500 cursor-pointer filter">
                      <input
                      type="checkbox"
                      id="filter-by-${tag}"
                      name="filter-by-${tag}"
                      value="${tag}"
                      class="hidden"/>${tag}
                    </label>`;
        }
        return { tags, options };
      };

      const appendFilterToPage = ({ tags, options }) => {
        document.getElementById("filters").innerHTML = options;
        return { tags, options };
      };

      const addOnChangeEventToFilter = ({ tags, options }) => {
        document
          .querySelectorAll(".filter")
          .values()
          .forEach((option) => {
            option.addEventListener("change", (event) => {
              if (option.children[0].checked) {
                option.classList.replace("bg-gray-100", "bg-gray-800");
                option.classList.replace("text-gray-800", "text-white");
                option.classList.replace("border-gray-500", "border-gray-900");
              } else {
                option.classList.replace("bg-gray-800", "bg-gray-100");
                option.classList.replace("text-white", "text-gray-800");
                option.classList.replace("border-gray-900", "border-gray-500");
              }

              let selectedOptions = [];
              document
                .querySelectorAll('.filter input[type="checkbox"]:checked')
                .values()
                .forEach((opt) => {
                  selectedOptions.push(opt.value);
                });
              const unselectedOptions = tags.filter(
                (tag) => !selectedOptions.includes(tag)
              );

              console.log({selectedOptions, unselectedOptions})

              if (
                unselectedOptions.length === 0 ||
                unselectedOptions.length === tags.length
              ) {
                document
                  .querySelectorAll(".tagged-to-filter")
                  .values()
                  .forEach((row) => {
                    row.classList.remove("hidden");
                  });
                return;
              }

              unselectedOptions.forEach(opt=>{
                document
                .querySelectorAll(
                  `.tagged-to-filter[data-tags="${opt}"]`
                )
                .values()
                .forEach((row) => {
                  row.classList.add("hidden");
                });
              });

              
            });
          });
      };

      pipeFunctions(
        buildGalleryContent,
        buildGrid,
        appendGridToPage,
        addClickEventToPresentationBox,
        addClickEventsToImgs
      )({amountOfImgs: _AMOUNT_OF_IMGS, amountOfVids: _AMOUNT_OF_VIDS});
      pipeFunctions(
        buildFilter,
        appendFilterToPage,
        addOnChangeEventToFilter
      )({ tags: _TAGS });
    })();
  </script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-22CH29ZJPY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-22CH29ZJPY');
  </script>
</html>
